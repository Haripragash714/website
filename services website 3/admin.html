<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Users</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for modals */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            width: 90%;
            max-width: 500px;
        }
        /* Tailwind's 'hidden' class will be used for checkbox visibility */
    </style>
</head>
<body class="bg-gray-100 flex h-screen">

    <!-- Sidebar -->
    <aside class="w-64 bg-gray-800 text-white p-6 flex flex-col rounded-tr-xl rounded-br-xl">
        <div class="text-2xl font-bold mb-8 rounded-md">Admin Panel</div>
        <nav class="flex-1">
            <ul>
                <li class="mb-4">
                    <a href="#" class="flex items-center p-3 rounded-lg hover:bg-gray-700 transition duration-200">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                        Dashboard
                    </a>
                </li>
                <li class="mb-4">
                    <a href="#" class="flex items-center p-3 rounded-lg bg-gray-700">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h-5v-2a3 3 0 013-3h2a3 3 0 013 3v2h-5zM17 10V8a2 2 0 00-2-2H9a2 2 0 00-2 2v2m-4 6h16a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v11a2 2 0 002 2z"></path></svg>
                        Users
                    </a>
                </li>
                <li class="mb-4">
                    <a href="#" class="flex items-center p-3 rounded-lg hover:bg-gray-700 transition duration-200">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.792 0-7.397-.478-10-1.745M19 19v-2a3 3 0 00-3-3H8a3 3 0 00-3 3v2m3-7a4 4 0 11-8 0 4 4 0 018 0zm6 0a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                        Professionals
                    </a>
                </li>
                <li class="mb-4">
                    <a href="#" class="flex items-center p-3 rounded-lg hover:bg-gray-700 transition duration-200">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                        Orders
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-8">
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-semibold text-gray-800">Users</h1>
            <div class="flex items-center space-x-4">
                <span class="text-gray-700">Admin User</span>
                <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold">AU</div>
            </div>
        </header>

        <section class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">Users</h2>

            <!-- Action Buttons -->
            <div class="flex space-x-4 mb-6">
                <button id="add-user-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out">
                    Add User
                </button>
                <button id="edit-user-btn" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out">
                    Edit User
                </button>
                <button id="remove-selected-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out">
                    Remove Selected
                </button>
                <button id="cancel-remove-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out hidden">
                    Cancel
                </button>
            </div>

            <div class="overflow-x-auto">
                <table class="min-w-full bg-white rounded-lg">
                    <thead>
                        <tr class="bg-gray-50 text-left text-gray-600 uppercase text-sm leading-normal">
                            <th class="py-3 px-6 rounded-tl-lg checkbox-header hidden">
                                <input type="checkbox" id="select-all" class="form-checkbox h-4 w-4 text-blue-600 rounded">
                            </th>
                            <th class="py-3 px-6">User ID</th>
                            <th class="py-3 px-6">Name</th>
                            <th class="py-3 px-6">Email</th>
                            <th class="py-3 px-6">Mobile Number</th>
                            <th class="py-3 px-6 rounded-tr-lg">Address</th>
                        </tr>
                    </thead>
                    <tbody id="user-table-body" class="text-gray-700 text-base">
                        <tr class="border-b border-gray-200 hover:bg-gray-100">
                            <td class="py-3 px-6 checkbox-cell hidden">
                                <input type="checkbox" class="user-checkbox h-4 w-4 text-blue-600 rounded">
                            </td>
                            <td class="py-3 px-6">#001</td>
                            <td class="py-3 px-6">John Doe</td>
                            <td class="py-3 px-6">john.doe@example.com</td>
                            <td class="py-3 px-6">123-456-7890</td>
                            <td class="py-3 px-6">123 Main St, Anytown, USA</td>
                        </tr>
                        <tr class="border-b border-gray-200 hover:bg-gray-100">
                            <td class="py-3 px-6 checkbox-cell hidden">
                                <input type="checkbox" class="user-checkbox h-4 w-4 text-blue-600 rounded">
                            </td>
                            <td class="py-3 px-6">#002</td>
                            <td class="py-3 px-6">Jane Smith</td>
                            <td class="py-3 px-6">jane.smith@example.com</td>
                            <td class="py-3 px-6">987-654-3210</td>
                            <td class="py-3 px-6">456 Oak Ave, Somewhere, USA</td>
                        </tr>
                        <tr class="hover:bg-gray-100">
                            <td class="py-3 px-6 checkbox-cell hidden">
                                <input type="checkbox" class="user-checkbox h-4 w-4 text-blue-600 rounded">
                            </td>
                            <td class="py-3 px-6">#003</td>
                            <td class="py-3 px-6">Peter Jones</td>
                            <td class="py-3 px-6">peter.jones@example.com</td>
                            <td class="py-3 px-6">555-123-4567</td>
                            <td class="py-3 px-6">789 Pine Ln, Nowhere, USA</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <!-- Add User Modal -->
    <div id="add-user-modal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-semibold mb-4">Add New User</h3>
            <form id="add-user-form" class="space-y-4">
                <div>
                    <label for="new-user-id" class="block text-sm font-medium text-gray-700">User ID</label>
                    <input type="text" id="new-user-id" name="userId" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500" placeholder="#004" required>
                </div>
                <div>
                    <label for="new-user-name" class="block text-sm font-medium text-gray-700">Name</label>
                    <input type="text" id="new-user-name" name="name" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500" placeholder="New User Name" required>
                </div>
                <div>
                    <label for="new-user-email" class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="new-user-email" name="email" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500" placeholder="new.user@example.com" required>
                </div>
                <div>
                    <label for="new-user-mobile" class="block text-sm font-medium text-gray-700">Mobile Number</label>
                    <input type="text" id="new-user-mobile" name="mobile" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500" placeholder="xxx-xxx-xxxx" required>
                </div>
                <div>
                    <label for="new-user-address" class="block text-sm font-medium text-gray-700">Address</label>
                    <input type="text" id="new-user-address" name="address" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500" placeholder="123 New St, City, Country" required>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" id="cancel-add-user" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out">
                        Cancel
                    </button>
                    <button type="submit" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out">
                        Add User
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div id="edit-user-modal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-semibold mb-4">Edit User Details</h3>
            <form id="edit-user-form" class="space-y-4">
                <div>
                    <label for="edit-user-id" class="block text-sm font-medium text-gray-700">User ID</label>
                    <input type="text" id="edit-user-id" name="userId" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500" readonly>
                </div>
                <div>
                    <label for="edit-user-name" class="block text-sm font-medium text-gray-700">Name</label>
                    <input type="text" id="edit-user-name" name="name" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div>
                    <label for="edit-user-email" class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="edit-user-email" name="email" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div>
                    <label for="edit-user-mobile" class="block text-sm font-medium text-gray-700">Mobile Number</label>
                    <input type="text" id="edit-user-mobile" name="mobile" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div>
                    <label for="edit-user-address" class="block text-sm font-medium text-gray-700">Address</label>
                    <input type="text" id="edit-user-address" name="address" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" id="cancel-edit-user" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out">
                        Cancel
                    </button>
                    <button type="submit" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const addUserBtn = document.getElementById('add-user-btn');
            const editUserBtn = document.getElementById('edit-user-btn');
            const removeSelectedBtn = document.getElementById('remove-selected-btn');
            const cancelRemoveBtn = document.getElementById('cancel-remove-btn');
            const addUserModal = document.getElementById('add-user-modal');
            const editUserModal = document.getElementById('edit-user-modal');
            const cancelAddUserBtn = document.getElementById('cancel-add-user');
            const cancelEditUserBtn = document.getElementById('cancel-edit-user');
            const addUserForm = document.getElementById('add-user-form');
            const editUserForm = document.getElementById('edit-user-form');
            const userTableBody = document.getElementById('user-table-body');
            const selectAllCheckbox = document.getElementById('select-all');
            const selectAllCheckboxHeader = document.querySelector('.checkbox-header'); // Get the th for select-all

            let isRemoveModeActive = false; // State to track remove mode
            let isEditModeActiive=false;
            let currentRowToEdit = null; // To store the row being edited

            // Function to toggle checkbox visibility (including table headers/cells)
            const toggleCheckboxesVisibility = (show) => {
                selectAllCheckboxHeader.classList.toggle('hidden', !show);
                document.querySelectorAll('.checkbox-cell').forEach(cell => {
                    cell.classList.toggle('hidden', !show);
                });
            };

            // Initially hide all checkboxes and their respective table cells/headers
            toggleCheckboxesVisibility(false);


            // Show Add User Modal
            addUserBtn.addEventListener('click', () => {
                addUserModal.style.display = 'flex';
            });

            // Hide Add User Modal
            cancelAddUserBtn.addEventListener('click', () => {
                addUserModal.style.display = 'none';
                addUserForm.reset(); // Clear the form
            });

            // Add User Form Submission
            addUserForm.addEventListener('submit', (event) => {
                event.preventDefault(); // Prevent default form submission

                const userId = document.getElementById('new-user-id').value;
                const name = document.getElementById('new-user-name').value;
                const email = document.getElementById('new-user-email').value;
                const mobile = document.getElementById('new-user-mobile').value;
                const address = document.getElementById('new-user-address').value;

                // Create a new table row
                const newRow = document.createElement('tr');
                newRow.className = 'border-b border-gray-200 hover:bg-gray-100'; // Apply styling
                newRow.innerHTML = `
                    <td class="py-3 px-6 checkbox-cell ${isRemoveModeActive || isEditModeActiive || editUserModal.style.display === 'flex' ? '' : 'hidden'}">
                        <input type="checkbox" class="user-checkbox h-4 w-4 text-blue-600 rounded">
                    </td>
                    <td class="py-3 px-6">${userId}</td>
                    <td class="py-3 px-6">${name}</td>
                    <td class="py-3 px-6">${email}</td>
                    <td class="py-3 px-6">${mobile}</td>
                    <td class="py-3 px-6">${address}</td>
                `;

                // Append the new row to the table body
                userTableBody.appendChild(newRow);

                // Clear form and hide modal
                addUserForm.reset();
                addUserModal.style.display = 'none';

                // Re-evaluate selectAllCheckbox state after adding a new row
                updateSelectAllCheckboxState();

                console.log('New user added:', { userId, name, email, mobile, address });
            });

            // Edit User Button Click
            editUserBtn.addEventListener('click', () => {

                if(!isEditModeActiive){
                    isEditModeActiive = true;
                    
                     toggleCheckboxesVisibility(true); // Show checkboxes when entering edit mode
                     cancelRemoveBtn.classList.remove('hidden');
                     addUserBtn.classList.add('hidden');
                     removeSelectedBtn.classList.add('hidden');


                     

                }
            
                

                else {
                    // Confirm removal
                    const checkedCheckboxes = document.querySelectorAll('.user-checkbox:checked');
                    if (checkedCheckboxes.length === 0) {
                        alert('Please select at least one user to remove.');
                        return;
                    }
                }
                

                // Get the selected row
                currentRowToEdit = checkedCheckboxes[0].closest('tr');
                const cells = currentRowToEdit.querySelectorAll('td');

                // Populate the edit modal with current user data
                document.getElementById('edit-user-id').value = cells[1].innerText;
                document.getElementById('edit-user-name').value = cells[2].innerText;
                document.getElementById('edit-user-email').value = cells[3].innerText;
                document.getElementById('edit-user-mobile').value = cells[4].innerText;
                document.getElementById('edit-user-address').value = cells[5].innerText;

                // Show the edit modal
                editUserModal.style.display = 'flex';
            });

            // Hide Edit User Modal
            cancelEditUserBtn.addEventListener('click', () => {
                editUserModal.style.display = 'none';
                editUserForm.reset(); // Clear the form
                currentRowToEdit = null; // Reset the reference
                toggleCheckboxesVisibility(false); // Hide checkboxes after canceling edit
                uncheckAllUsers(); // Deselect all on cancel
            });

            // Edit User Form Submission
            editUserForm.addEventListener('submit', (event) => {
                event.preventDefault(); // Prevent default form submission

                if (!currentRowToEdit) {
                    console.error('No row selected for editing.');
                    return;
                }

                const updatedName = document.getElementById('edit-user-name').value;
                const updatedEmail = document.getElementById('edit-user-email').value;
                const updatedMobile = document.getElementById('edit-user-mobile').value;
                const updatedAddress = document.getElementById('edit-user-address').value;

                const cells = currentRowToEdit.querySelectorAll('td');
                cells[2].innerText = updatedName;
                cells[3].innerText = updatedEmail;
                cells[4].innerText = updatedMobile;
                cells[5].innerText = updatedAddress;

                // Hide the modal and reset
                editUserModal.style.display = 'none';
                editUserForm.reset();
                currentRowToEdit = null;
                toggleCheckboxesVisibility(false); // Hide checkboxes after saving changes
                uncheckAllUsers(); // Deselect the edited user

                console.log('User updated:', { updatedName, updatedEmail, updatedMobile, updatedAddress });
            });

            // Toggle Remove Mode / Confirm Removal
            removeSelectedBtn.addEventListener('click', () => {
                if (!isRemoveModeActive) {
                    // Enter remove mode
                    isRemoveModeActive = true;
                    toggleCheckboxesVisibility(true); // Show checkboxes
                    removeSelectedBtn.innerText = 'Confirm Remove';
                    cancelRemoveBtn.classList.remove('hidden');
                    addUserBtn.classList.add('hidden'); // Hide Add button
                    editUserBtn.classList.add('hidden'); // Hide Edit button
                } else {
                    // Confirm removal
                    const checkedCheckboxes = document.querySelectorAll('.user-checkbox:checked');
                    if (checkedCheckboxes.length === 0) {
                        alert('Please select at least one user to remove.');
                        return;
                    }

                    if (confirm(`Are you sure you want to remove ${checkedCheckboxes.length} selected user(s)?`)) {
                        checkedCheckboxes.forEach(checkbox => {
                            checkbox.closest('tr').remove();
                        });
                        // Exit remove mode after removal
                        exitRemoveMode();
                        updateSelectAllCheckboxState(); // Update select all state
                    }
                }
            });

            // Cancel Remove Mode
            cancelRemoveBtn.addEventListener('click', () => {
                exitRemoveMode();
            });

            // Function to exit remove mode
            const exitRemoveMode = () => {
                isRemoveModeActive = false;
                toggleCheckboxesVisibility(false); // Hide checkboxes
                removeSelectedBtn.innerText = 'Remove Selected';
                cancelRemoveBtn.classList.add('hidden');
                addUserBtn.classList.remove('hidden'); // Show Add button
                editUserBtn.classList.remove('hidden'); // Show Edit button
                removeSelectedBtn.classList.remove('hidden');

                uncheckAllUsers();
                updateSelectAllCheckboxState(); // Update select all state
            };

            // Function to uncheck all user checkboxes
            const uncheckAllUsers = () => {
                selectAllCheckbox.checked = false;
                document.querySelectorAll('.user-checkbox').forEach(checkbox => {
                    checkbox.checked = false;
                });
            };

            // Select All / Deselect All
            selectAllCheckbox.addEventListener('change', (event) => {
                document.querySelectorAll('.user-checkbox').forEach(checkbox => {
                    checkbox.checked = event.target.checked;
                });
            });

            // Update Select All checkbox based on individual checkboxes
            userTableBody.addEventListener('change', (event) => {
                if (event.target.classList.contains('user-checkbox')) {
                    updateSelectAllCheckboxState();
                }
            });

            const updateSelectAllCheckboxState = () => {
                // Only count visible checkboxes for selectAll state
                const totalCheckboxes = document.querySelectorAll('.user-checkbox:not(.hidden)').length;
                const checkedCheckboxes = document.querySelectorAll('.user-checkbox:checked:not(.hidden)').length;
                selectAllCheckbox.checked = totalCheckboxes > 0 && totalCheckboxes === checkedCheckboxes;
                selectAllCheckbox.disabled = totalCheckboxes === 0; // Disable if no checkboxes are visible
            };
        });
    </script>
</body>
</html>
